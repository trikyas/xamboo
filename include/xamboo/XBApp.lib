<?php

/*
    XBApp.lib, Xamboo
    Contains the basic class to contains a page object instance
    (c) 2012 Philippe Thomassigny

    This file is part of Xamboo

    Xamboo is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Xamboo is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Xamboo.  If not, see <http://www.gnu.org/licenses/>.
*/

/* @UML_App
|------------------------------------------------------------------|
| XBApp: page object                                              |
|------------------------------------------------------------------|
| # id: string                                                     |
| # lang: boolean                                                  |
| # entries: Array(id => string)                                   |
|------------------------------------------------------------------|
| + new XBApp($data, $id = null, $lang = null)                    |
| + getId(): string                                                |
| + getLang(): string                                              |
| + getEntry($id: string): string                                  |
| + delEntry($id: string): void                                    |
| + setEntry($id: string, $data: string): void                     |
| # serial($data: array): void                                     |
| # unserial($data: array): void                                   |
| + __toString(): string                                           |
|------------------------------------------------------------------|
@End_UML_App */

// Class to manage a page object
class XBApp extends WAObject
{
  protected $template;
  protected $language;

  public function __construct($template, $language)
  {
    parent::__construct();

    $this->template = $template;
    $this->language = $language;
  }

  public function run($engine, $params)
  {
    if (is_array($params) && isset($params[1]) && $params[1])
    {
      if ($params[1] == 'app')
      {
        if ($this->template instanceof WATemplate)
        {
          if ($this->language instanceof WALanguage)
          {
            foreach($this->language as $e => $m)
            {
              $this->template->addElement('##'.$e.'##', $m);
            }
          }
          $code = $this->template->resolve();
          $tree = xmltoarray::parse($code);
          return json_encode($tree);
        }
      }
      else
      {
        $fct = $params[1];
        return json_encode($this->$fct($engine, $params));
      }
    }
    return json_encode(array('error' => 'La libreria no esta sobrecargando el método run(). Favor de completar la libreria.'));
  }

  public function integrateLanguage($data)
  {
    if ($this->language instanceof WALanguage)
    {
      foreach($this->language as $e => $m)
      {
        $data = str_replace('##'.$e.'##', $m, $data);
      }
    }
    return $data;
  }
  
  public function __toString()
  {
    return 'App page';
  }

}

?>