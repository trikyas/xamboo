<?php

class CacheServer extends Multiton
{
  private $cache;

  public function __construct($id)
  {
    parent::__construct($id);

    // Separate page path from page id
    $uid = (strpos($id, '/') !== false)?substr($id, strrpos($id, '/')+1):$id;
    
    $this->cache = new FastObjectSource(
        new FileSource($this->base->CACHE2DIR, 'cache/'. $this->base->PAGESCONTAINER . '/' . $id . '/', $uid . '.cache.afo', true),
        $this->base->SHM?new SHMSource( $this->base->PAGESCONTAINER . '/' . $id . '/' . $uid . '.cache.afo', $this->base->SHM):null
      );
  }
  
  public function read()
  {
    return $this->cache->read();
  }

  public function write($data)
  {
    return $this->cache->write($data);
  }

}

?>